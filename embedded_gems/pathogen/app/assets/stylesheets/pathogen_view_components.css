/* Pathogen View Components
 * Architecture: @layer tokens → utilities → components
 * Color space: oklch (perceptually uniform)
 * Dark mode: dual support (.dark class + prefers-color-scheme)
 *
 * Layers establish cascade order so host-app Tailwind utilities
 * can override component internals when needed.
 */
@layer pathogen.tokens, pathogen.utilities, pathogen.components;

@layer pathogen.tokens {
  /* Foundation tokens (Pathogen-owned defaults with host override points) */
  :root {
    /* --- Primitive palette (oklch) --- */
    --pathogen-color-neutral-950: oklch(0.269 0.036 263.7);
    --pathogen-color-neutral-900: oklch(0.326 0.048 264.3);
    --pathogen-color-neutral-700: oklch(0.483 0.05 260.3);
    --pathogen-color-neutral-500: oklch(0.64 0.037 259.4);
    --pathogen-color-neutral-300: oklch(0.824 0.025 259.8);
    --pathogen-color-neutral-200: oklch(0.904 0.017 256.3);
    --pathogen-color-neutral-100: oklch(0.952 0.01 248.1);
    --pathogen-color-neutral-50: oklch(0.981 0.005 248.1);

    --pathogen-color-brand-500: oklch(0.723 0.192 149.6);
    --pathogen-color-brand-600: oklch(0.627 0.17 149.2);
    --pathogen-color-brand-700: oklch(0.527 0.137 150.1);
    --pathogen-color-success-500: oklch(0.627 0.17 149.2);
    --pathogen-color-warning-500: oklch(0.681 0.142 75.8);
    --pathogen-color-danger-500: oklch(0.577 0.215 27.3);

    /* --- Semantic aliases --- */
    --pathogen-color-text-default: var(--pathogen-color-neutral-900);
    --pathogen-color-text-muted: var(--pathogen-color-neutral-700);
    --pathogen-color-border-default: var(--pathogen-color-neutral-200);
    --pathogen-color-border-strong: var(--pathogen-color-neutral-300);
    --pathogen-color-surface-default: oklch(1 0 0);
    --pathogen-color-surface-subtle: var(--pathogen-color-neutral-50);
    --pathogen-color-surface-sticky: oklch(0.962 0.012 252.2);
    --pathogen-color-focus-ring: var(--pathogen-color-neutral-700);
    --pathogen-color-link: color-mix(
      in oklab,
      var(--pathogen-color-text-default) 76%,
      var(--pathogen-color-brand-600) 24%
    );
    --pathogen-color-highlight: color-mix(
      in oklab,
      var(--pathogen-color-brand-500) 34%,
      transparent
    );

    /* --- Typography --- */
    --pathogen-font-sans:
      "Inter", "Avenir Next", "Segoe UI", -apple-system, BlinkMacSystemFont,
      sans-serif;
    --pathogen-font-mono:
      ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
      "Courier New", monospace;
    --pathogen-text-sm: 0.875rem;
    --pathogen-leading-normal: 1.45;

    /* --- Spacing & shape --- */
    --pathogen-radius-control: 0.375rem;
    --pathogen-radius-surface: 0.5rem;
    --pathogen-space-cell-x: 0.875rem;
    --pathogen-space-cell-y: 0.75rem;
    --pathogen-shadow-border: oklch(0.326 0.048 264.3 / 0.14);
  }

  /* Dark mode: system preference (standalone gem usage) */
  @media (prefers-color-scheme: dark) {
    :root:not(.light) {
      --pathogen-color-text-default: oklch(0.919 0.017 256.3);
      --pathogen-color-text-muted: oklch(0.826 0.029 258.4);
      --pathogen-color-border-default: oklch(0.376 0.048 263.7);
      --pathogen-color-border-strong: oklch(0.454 0.056 260);
      --pathogen-color-surface-default: oklch(0.198 0.037 264.2);
      --pathogen-color-surface-subtle: oklch(0.25 0.051 262.5);
      --pathogen-color-surface-sticky: oklch(0.275 0.058 261.5);
      --pathogen-color-focus-ring: oklch(0.826 0.029 258.4);
      --pathogen-color-link: color-mix(
        in oklab,
        var(--pathogen-color-text-default) 82%,
        var(--pathogen-color-brand-500) 18%
      );
      --pathogen-color-highlight: color-mix(
        in oklab,
        var(--pathogen-color-brand-500) 56%,
        transparent
      );
      --pathogen-shadow-border: oklch(0.826 0.029 258.4 / 0.24);
    }
  }

  /* Dark mode: host app class-based toggle */
  .dark {
    --pathogen-color-text-default: oklch(0.919 0.017 256.3);
    --pathogen-color-text-muted: oklch(0.826 0.029 258.4);
    --pathogen-color-border-default: oklch(0.376 0.048 263.7);
    --pathogen-color-border-strong: oklch(0.454 0.056 260);
    --pathogen-color-surface-default: oklch(0.198 0.037 264.2);
    --pathogen-color-surface-subtle: oklch(0.25 0.051 262.5);
    --pathogen-color-surface-sticky: oklch(0.275 0.058 261.5);
    --pathogen-color-focus-ring: oklch(0.826 0.029 258.4);
    --pathogen-color-link: color-mix(
      in oklab,
      var(--pathogen-color-text-default) 82%,
      var(--pathogen-color-brand-500) 18%
    );
    --pathogen-color-highlight: color-mix(
      in oklab,
      var(--pathogen-color-brand-500) 56%,
      transparent
    );
    --pathogen-shadow-border: oklch(0.826 0.029 258.4 / 0.24);
  }
} /* end @layer pathogen.tokens */

@layer pathogen.utilities {
  /* Shared Pathogen primitives.
 * `pathogen-u-*` selectors are retained as temporary compatibility aliases.
 */
  .pathogen-u-text-default,
  .pathogen-data-grid__text--default {
    color: var(--pathogen-color-text-default);
  }

  .pathogen-u-text-muted,
  .pathogen-data-grid__text--muted {
    color: var(--pathogen-color-text-muted);
  }

  .pathogen-u-link,
  .pathogen-data-grid__link {
    color: var(--pathogen-color-link);
    font-weight: 600;
    text-decoration-line: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 0.12em;
    transition:
      color 140ms ease,
      text-decoration-thickness 140ms ease;
  }

  .pathogen-u-link:hover,
  .pathogen-data-grid__link:hover {
    text-decoration-thickness: 2px;
  }

  .pathogen-u-link:focus-visible,
  .pathogen-data-grid__link:focus-visible {
    outline: 2px solid var(--pathogen-color-focus-ring);
    outline-offset: 2px;
    border-radius: var(--pathogen-radius-control);
  }

  .pathogen-u-link--subtle,
  .pathogen-data-grid__link--subtle,
  .pathogen-data-grid__link--sample,
  .pathogen-data-grid__link--project {
    color: color-mix(
      in oklab,
      var(--pathogen-color-text-default) 84%,
      transparent
    );
  }

  .pathogen-u-link--subtle:hover,
  .pathogen-data-grid__link--subtle:hover,
  .pathogen-data-grid__link--sample:hover,
  .pathogen-data-grid__link--project:hover {
    color: var(--pathogen-color-link);
  }

  .pathogen-data-grid__value {
    color: var(--pathogen-color-text-default);
  }

  .pathogen-u-font-mono,
  .pathogen-data-grid__value--mono {
    font-family: var(--pathogen-font-mono);
    font-weight: 600;
  }

  .pathogen-u-highlight,
  .pathogen-data-grid__highlight {
    background: var(--pathogen-color-highlight);
    border-radius: var(--pathogen-radius-control);
    padding-inline: 0.06em;
  }

  .pathogen-u-highlight--strong,
  .pathogen-data-grid__highlight--strong {
    font-weight: 600;
  }

  .pathogen-u-surface {
    background: var(--pathogen-color-surface-default);
  }

  .pathogen-u-surface-subtle {
    background: var(--pathogen-color-surface-subtle);
  }

  .pathogen-u-border-default {
    border-color: var(--pathogen-color-border-default);
  }
} /* end @layer pathogen.utilities */

@layer pathogen.components {
  /* DataGrid component */
  .pathogen-data-grid {
    --pathogen-data-grid-border-color: var(--pathogen-color-border-default);
    --pathogen-data-grid-row-border: var(--pathogen-color-neutral-100);
    --pathogen-data-grid-text-color: var(--pathogen-color-text-default);
    --pathogen-data-grid-text-muted-color: var(--pathogen-color-text-muted);
    --pathogen-data-grid-header-bg: var(--pathogen-color-surface-default);
    --pathogen-data-grid-body-bg: var(--pathogen-color-surface-default);
    --pathogen-data-grid-sticky-bg: var(--pathogen-color-surface-default);
    --pathogen-data-grid-sticky-shadow: 4px 0 12px -2px
      color-mix(in oklab, var(--pathogen-color-neutral-950) 8%, transparent);
    --pathogen-data-grid-row-hover-bg: var(--pathogen-color-surface-subtle);
    --pathogen-data-grid-focus-ring: var(--pathogen-color-focus-ring);
    --pathogen-data-grid-cell-padding-y: 1rem;
    --pathogen-data-grid-cell-padding-x: 1rem;
    --pathogen-data-grid-font-size: var(--pathogen-text-sm);
    --pathogen-data-grid-line-height: var(--pathogen-leading-normal);
    --pathogen-data-grid-sticky-z: 2;
    --pathogen-data-grid-header-z: 3;

    max-width: 100%;
    /* Remove outer border for cleaner look, or make very subtle */
    border: 1px solid var(--pathogen-data-grid-border-color);
    border-radius: var(--pathogen-radius-surface);
    background: var(--pathogen-data-grid-body-bg);
    color: var(--pathogen-data-grid-text-color);
    font-family: var(--pathogen-font-sans);
    isolation: isolate;
    container-type: inline-size;
  }

  .pathogen-data-grid--fill {
    position: relative;
    display: flex;
    min-height: 0;
    flex: 0 1 auto;
    flex-direction: column;
  }

  .pathogen-data-grid--fill > .pathogen-data-grid__scroll {
    min-height: 0;
    flex: 0 1 auto;
  }

  .pathogen-data-grid__scroll {
    max-width: 100%;
    overflow: auto;
    border-radius: inherit;
  }

  .pathogen-data-grid__table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: var(--pathogen-data-grid-body-bg);
    color: var(--pathogen-data-grid-text-color);
    font-size: var(--pathogen-data-grid-font-size);
    line-height: var(--pathogen-data-grid-line-height);
    white-space: nowrap;
  }

  .pathogen-data-grid__caption {
    color: var(--pathogen-data-grid-text-color);
    font-weight: 600;
    padding: 1rem;
    text-align: left;
  }

  .pathogen-data-grid__row {
    background: var(--pathogen-data-grid-body-bg);
    transition: background-color 150ms ease;
  }

  .pathogen-data-grid__row--header {
    background: var(--pathogen-data-grid-header-bg);
  }

  /* Dense modifier for tighter tables (opt-in) */
  .pathogen-data-grid--dense {
    --pathogen-data-grid-cell-padding-y: 0.5rem;
    --pathogen-data-grid-cell-padding-x: 0.75rem;
    --pathogen-data-grid-font-size: 0.8125rem;
  }

  .pathogen-data-grid--dense .pathogen-data-grid__cell {
    border-right: 1px solid var(--pathogen-data-grid-border-color);
  }

  .pathogen-data-grid--dense
    .pathogen-data-grid__row
    > .pathogen-data-grid__cell:last-child {
    border-right: 0;
  }

  .pathogen-data-grid__cell {
    width: var(--pathogen-data-grid-col-width, auto);
    min-width: var(--pathogen-data-grid-col-width, auto);
    min-height: 2.5rem;
    box-sizing: border-box;
    color: var(--pathogen-data-grid-text-color);
    /*
     * Keep all table cells on a shared text baseline so `ch`-based sticky
     * offsets/widths resolve consistently across header and body cells.
     */
    font-size: var(--pathogen-data-grid-font-size);
    font-weight: 400;
    line-height: var(--pathogen-data-grid-line-height);
    /* Default: No vertical borders */
    border-bottom: 1px solid var(--pathogen-data-grid-row-border);
    background: inherit;
    background-clip: padding-box;
    padding: var(--pathogen-data-grid-cell-padding-y)
      var(--pathogen-data-grid-cell-padding-x);
    vertical-align: middle;
  }

  /* Last row needs no border bottom */
  .pathogen-data-grid__row:last-child > .pathogen-data-grid__cell {
    border-bottom: 0;
  }

  .pathogen-data-grid__cell--header {
    position: sticky;
    top: 0;
    z-index: var(--pathogen-data-grid-header-z);
    border-bottom: 1px solid var(--pathogen-data-grid-border-color);
    background: var(--pathogen-data-grid-header-bg);
    text-align: left;
    vertical-align: bottom;
  }

  .pathogen-data-grid__header-label {
    display: inline-block;
    color: var(--pathogen-data-grid-text-muted-color);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
  }

  .pathogen-data-grid__cell--sticky {
    position: sticky;
    left: var(--pathogen-data-grid-sticky-left, 0px);
    z-index: var(--pathogen-data-grid-sticky-z);
    background: inherit; /* Should match row bg (even on hover) */
    /*
     * Keep sticky rendering simple: Windows Chrome can rasterize sticky table
     * cells with clip-path/composited shadows at slightly different widths.
     * A stable separator avoids visual width drift while scrolling.
     */
    box-shadow: 1px 0 0 var(--pathogen-data-grid-border-color);
  }

  .pathogen-data-grid__cell--header.pathogen-data-grid__cell--sticky {
    z-index: calc(var(--pathogen-data-grid-header-z) + 1);
    background: var(--pathogen-data-grid-header-bg);
  }

  .pathogen-data-grid__cell--align-center {
    text-align: center;
  }

  .pathogen-data-grid__cell--align-right {
    text-align: right;
  }

  /* No default zebra striping in modern look */
  .pathogen-data-grid__body .pathogen-data-grid__row:hover,
  .pathogen-data-grid__body .pathogen-data-grid__row:focus-within {
    background: var(--pathogen-data-grid-row-hover-bg);
  }

  /* Ensure sticky cells inherit the row background (including hover state) */
  .pathogen-data-grid__cell--sticky {
    background: inherit;
  }

  .pathogen-data-grid__cell:focus-within {
    outline: 2px solid var(--pathogen-data-grid-focus-ring);
    outline-offset: -2px;
  }

  /* In table cells, keep a single focus ring on the cell container. */
  .pathogen-data-grid__cell .pathogen-u-link:focus-visible,
  .pathogen-data-grid__cell .pathogen-data-grid__link:focus-visible {
    outline: none;
  }

  .pathogen-data-grid__metadata-warning {
    margin: 0 0 1rem;
    border: 1px solid
      color-mix(
        in oklab,
        var(--pathogen-color-warning-500) 45%,
        var(--pathogen-data-grid-border-color)
      );
    border-radius: var(--pathogen-radius-control);
    background: color-mix(
      in oklab,
      var(--pathogen-color-warning-500) 12%,
      transparent
    );
    padding: 0.625rem 0.875rem;
  }

  .pathogen-data-grid__metadata-warning-text {
    color: var(--pathogen-data-grid-text-color);
    display: inline;
  }

  .pathogen-data-grid__link--template:hover {
    text-decoration-line: none;
  }

  @container (max-width: 64rem) {
    .pathogen-data-grid--multi-sticky
      .pathogen-data-grid__body
      .pathogen-data-grid__cell--sticky {
      position: static;
      left: auto;
      z-index: auto;
      box-shadow: none;
    }

    .pathogen-data-grid--multi-sticky
      .pathogen-data-grid__cell--header.pathogen-data-grid__cell--sticky {
      left: auto;
      z-index: var(--pathogen-data-grid-header-z);
      box-shadow: none;
    }
  }

  @media (max-width: 640px) {
    .pathogen-data-grid__cell--sticky {
      position: static;
      left: auto;
      z-index: auto;
      box-shadow: none;
    }

    .pathogen-data-grid__cell--header.pathogen-data-grid__cell--sticky {
      z-index: var(--pathogen-data-grid-header-z);
    }
  }
} /* end @layer pathogen.components */
