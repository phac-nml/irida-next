<%= form_with(url: "#", builder: Pathogen::FormBuilders::PathogenFormBuilder, local: true) do |form| %>
  <div class="space-y-4">
  <h3 class="text-lg font-medium text-slate-900 dark:text-white">Interactive Analysis Selection Example</h3>

    <div class="space-y-3">
      <%= render Pathogen::Form::Checkbox.new(
        :select_all_analyses,
        {
          label: "Select all analyses",
          help_text: "Enable all downstream analysis modules",
          onchange: "toggleAllCheckboxes(this)",
        },
        "1",
        "0",
        form: form,
      ) %>

      <div class="ml-6 space-y-2">
        <%= render Pathogen::Form::Checkbox.new(
          :analysis_amr,
          { label: "AMR detection", help_text: "Identify antimicrobial resistance genes" },
          "1",
          "0",
          form: form,
        ) %>

        <%= render Pathogen::Form::Checkbox.new(
          :analysis_mlst,
          { label: "MLST typing", help_text: "Assign multilocus sequence type" },
          "1",
          "0",
          form: form,
        ) %>

        <%= render Pathogen::Form::Checkbox.new(
          :analysis_serotype,
          { label: "Serotype prediction", help_text: "Predict serotype from genomic markers" },
          "1",
          "0",
          form: form,
        ) %>
      </div>
    </div>

    <div class="mt-4 p-3 bg-slate-50 dark:bg-slate-800 rounded-lg">
      <p class="text-sm text-slate-600 dark:text-slate-400">
        <strong>Note:</strong>
  This demonstrates grouping of analysis modules under a master control.
  The "Select all analyses" checkbox toggles individual analysis states.
      </p>
    </div>
  </div>
<% end %>

<script>
function toggleAllCheckboxes(masterCheckbox) {
  const checkboxes = document.querySelectorAll('input[name*="analysis_"]');
  const checkedCount = masterCheckbox.checked ? checkboxes.length : 0;

  checkboxes.forEach(checkbox => {
    checkbox.checked = masterCheckbox.checked;
  });

  // Announce the change to screen readers
  const announcement = masterCheckbox.checked
  ? `All ${checkedCount} analyses selected`
  : 'All analyses deselected';

  // Create a live region for announcements
  let liveRegion = document.getElementById('checkbox-announcement');
  if (!liveRegion) {
    liveRegion = document.createElement('div');
    liveRegion.id = 'checkbox-announcement';
    liveRegion.setAttribute('aria-live', 'polite');
    liveRegion.setAttribute('aria-atomic', 'true');
    liveRegion.className = 'sr-only';
    document.body.appendChild(liveRegion);
  }

  liveRegion.textContent = announcement;
}
</script>
