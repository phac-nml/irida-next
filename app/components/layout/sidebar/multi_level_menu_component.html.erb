<% control_id = "multi-level-menu_#{title.parameterize.underscore}" %>

<li
  class="group/menu list-none mr-1"
  data-controller="collapsible sidebar-item"
>
  <button
    type="button"
    class="
      flex items-center text-left p-2.5 m-1 rounded-lg transition-colors duration-200
      relative focus-visible:z-10 cursor-pointer w-full
      <%= class_names({
      'bg-primary-100 text-primary-800 dark:bg-slate-800 dark:text-primary-400 font-medium': selected,
      'text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800/70': !selected
      }) %>
    "
    id="<%= control_id %>-button"
    aria-controls="<%= control_id %>"
    aria-expanded="<%= @selected ? 'true' : 'false' %>"
    data-action="click->collapsible#toggle click->sidebar-item#onClick"
    data-collapsible-target="button"
    data-sidebar-item-target="trigger"
    data-turbo="false"
  >
    <span
      class="
        <%= class_names(
        'w-8 h-8 flex items-center justify-center rounded-lg mr-3 shrink-0 transition-colors duration-200',
        { 'bg-primary-300 dark:bg-slate-700/90' => @selected,
        'bg-slate-100 dark:bg-slate-800 group-hover/menu:bg-slate-200/70 dark:group-hover/menu:bg-slate-700/50' => !@selected }
        ) %>
      "
    >
      <%= create_icon %>
    </span>

    <span class="text-sm font-medium transition-opacity duration-200 ease-in-out flex-1">
      <%= title %>
    </span>

    <span
      data-collapsible-target="icon"
      class="<%= class_names("transition-transform duration-200 mr-2 flex-shrink-0", { "rotate-180": @selected }) %>"
    >
      <%= pathogen_icon(:caret_down, size: :sm, color: @selected ? :primary : :default) %>
    </span>
  </button>

  <ul
    id="<%= control_id %>"
    data-collapsible-target="item"
    class="<%= class_names('py-1 pl-2 space-y-1 overflow-hidden transition-all duration-200 border-l-2 border-slate-100 dark:border-slate-700 ml-6', { 'hidden': !@selected }) %>"
  >
    <% menu_items.each do |menu_item| %>
      <li class="Layout-Sidebar-MultiLevelMenu__Item list-none p-1 pr-2">
        <% link_classes = class_names(
          "flex items-center py-1 pr-1 w-full transition-colors ease-in-out delay-75 focus-visible:z-10 rounded-lg group min-h-11 pl-10",
          {
            'bg-slate-300 text-slate-900 dark:bg-slate-700 dark:text-slate-50' => menu_item.selected,
            'hover:bg-slate-50 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-slate-50' => !menu_item.selected
          }
        ) %>

        <%= link_to menu_item.url, { class: link_classes, **(menu_item.selected ? { aria: { current: 'page' } } : {}) } do %>
          <span class="grow"><%= menu_item.label %></span>
          <%= render_icon(menu_item.icon, menu_item.selected) if menu_item.icon.present? %>
        <% end %>
      </li>
    <% end %>
  </ul>
</li>
