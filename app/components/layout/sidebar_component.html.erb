<nav
  id="sidebar"
  class="
    @container/sidebar z-30 flex w-[280px] max-w-screen sidebar flex-col border-r border-slate-200/50 bg-white/80
    text-sm backdrop-blur-sm transition-all duration-300 ease-in-out max-xl:fixed max-xl:top-0 max-xl:bottom-0
    dark:border-slate-700/30 dark:bg-slate-900/80
  "
  aria-label="<%= t(:'general.default_sidebar.aria_label') %>"
>
  <div class="flex h-full flex-col max-sm:overflow-y-auto sm:overflow-y-hidden">
    <header class="bg-slate-200/80 dark:bg-slate-700/80">
      <div
        class="
          flex min-h-16 flex-wrap content-stretch items-center justify-center px-2
          @min-[279px]/sidebar:justify-between
        "
      >
        <a href="<%= root_path %>" class="inline-flex items-center py-2.5 whitespace-nowrap" data-layout-target="logo">
          <%= pathogen_icon(
            :beaker,
            library: :heroicons,
            size: :lg,
            color: nil,
            class: "rotate-12 text-primary-600 dark:text-primary-400",
          ) %>

          <span class="text-sm font-semibold text-slate-700 dark:text-slate-200"><%= t(:"general.name") %></span>
        </a>

        <div class="flex flex-row items-center gap-x-1">
          <% collapse_tooltip_id =
            Pathogen::Tooltip.generate_id(base_name: "sidebar-collapse") %>

          <div data-controller="pathogen--tooltip">
            <%= tag.button(
              pathogen_icon(:sidebar),
              type: :button,
              data: {
                action: "click->layout#collapse",
                **{ "layout-target": "collapseButton" },
                **{ "pathogen--tooltip-target": "trigger" },
              },
              aria: {
                describedby: collapse_tooltip_id,
                label: t(:"general.navbar.toggle_sidebar"),
                controls: "sidebar",
                expanded: true,
              },
              class:
                "navbar-button cursor-pointer p-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200",
            ) %>

            <%= render Pathogen::Tooltip.new(
              text: t(:"general.navbar.toggle_sidebar"),
              id: collapse_tooltip_id,
              placement: :bottom,
            ) %>
          </div>

          <!-- Add new items -->
          <%= viral_dropdown(
            icon: :plus,
            trigger_id: "sidebar-new-dropdown-trigger",
            tooltip: t("general.navbar.new_dropdown.label"),
            tooltip_placement: :bottom,
            styles: {
              button: "
                navbar-button cursor-pointer p-2 rounded-lg transition-colors hover:bg-slate-100
                dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 hover:text-slate-700
                dark:hover:text-slate-200
              "
            },
            aria: { label: t(:'general.navbar.new_dropdown.label') }
          ) do |dropdown| %>
            <%= dropdown.with_item(
              label: t(:"general.navbar.new_dropdown.project"),
              url: new_project_path,
            ) %>

            <%= dropdown.with_item(
              label: t(:"general.navbar.new_dropdown.group"),
              url: new_group_path,
            ) %>
          <% end %>

          <!-- Profile menu -->
          <%= viral_dropdown(
            icon: User.icon,
            trigger_id: "sidebar-account-dropdown-trigger",
            tooltip: t(:"general.navbar.account_dropdown.label"),
            tooltip_placement: :bottom,
            styles: {
              button: "
                navbar-button cursor-pointer p-2 rounded-lg transition-colors hover:bg-slate-100
                dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 hover:text-slate-700
                dark:hover:text-slate-200
              "
            },
            aria: { label: t(:'general.navbar.account_dropdown.label') }
          ) do |dropdown| %>
            <%= dropdown.with_item(
              label: t(:"general.navbar.account_dropdown.profile"),
              url: profile_path,
            ) %>

            <%= dropdown.with_item(
              label: t(:"general.navbar.account_dropdown.sign_out"),
              url: destroy_user_session_path,
              data: {
                turbo_method: :delete,
              },
            ) %>
          <% end %>
        </div>
      </div>

      <div
        class="pt shrink-0 p-2"
        <% if Flipper.enabled?(:beta_dropdown) %>
          data-controller="viral--beta-dropdown"
        <% else %>
          data-controller="viral--dropdown"
          data-viral--dropdown-skidding-value="0"
          data-viral--dropdown-distance-value="5"
          data-viral--dropdown-position-value="bottom-start"
        <% end %>
      >
        <button
          class="
            inline-flex h-auto min-h-11 w-full min-w-11 cursor-pointer items-center justify-center rounded-lg border
            border-slate-300 bg-slate-50 px-4 py-2.5 text-sm font-semibold text-slate-900 transition duration-200
            hover:bg-slate-100 hover:text-slate-950 disabled:cursor-not-allowed disabled:border-slate-200
            disabled:bg-slate-100 disabled:text-slate-500 disabled:opacity-80 dark:border-slate-700
            dark:bg-slate-900 dark:text-slate-50 dark:hover:bg-slate-800 dark:hover:text-white
            disabled:dark:border-slate-700 disabled:dark:bg-slate-800 disabled:dark:text-slate-400
          "
          <% if Flipper.enabled?(:beta_dropdown) %>
            data-viral--beta-dropdown-target="trigger"
          <% else %>
            data-viral--dropdown-target="trigger"
          <% end %>
          aria-haspopup="true"
          aria-controls="sidebar-dd-menu"
          aria-expanded="false"
        >
          <%= t(:"general.default_sidebar.goto") %>
        </button>

        <ul
          id="sidebar-dd-menu"
          <% if Flipper.enabled?(:beta_dropdown) %>
            data-viral--beta-dropdown-target="menu"
          <% else %>
            data-viral--dropdown-target="menu"
          <% end %>
          class="z-20 mx-3 w-56 divide-y divide-slate-100 rounded-lg bg-white shadow-sm dark:bg-slate-700"
          tabindex="-1"
          hidden
          role="menu"
        >
          <li role="none">
            <div id="sidebar-dd-your-work-group" class="py-2 pl-4 font-semibold text-slate-900 dark:text-white">
              <%= t(:"general.default_sidebar.title") %>
            </div>

            <ul
              class="w-full py-2 text-sm text-slate-700 dark:text-slate-200"
              aria-labelledby="sidebar-dd-your-work-group"
              tabindex="-1"
            >
              <li role="presentation">
                <%= link_to t(:"general.default_sidebar.projects"),
                dashboard_projects_path,
                role: "menuitem",
                class:
                  "px-4 py-2 relative focus-visible:z-10 block text-base hover:bg-slate-100 hover:cursor-pointer dark:hover:bg-slate-600" %>
              </li>

              <li role="presentation">
                <%= link_to t(:"general.default_sidebar.groups"),
                groups_path,
                role: "menuitem",
                class:
                  "px-4 py-2 block relative focus-visible:z-10 text-base hover:bg-slate-100 hover:cursor-pointer dark:hover:bg-slate-600" %>
              </li>

              <li role="presentation">
                <%= link_to t(:"general.default_sidebar.workflows"),
                workflow_executions_path,
                role: "menuitem",
                class:
                  "px-4 py-2 block relative focus-visible:z-10 text-base hover:bg-slate-100 hover:cursor-pointer dark:hover:bg-slate-600" %>
              </li>

              <li role="presentation">
                <%= link_to t(:"general.default_sidebar.data_exports"),
                data_exports_path,
                role: "menuitem",
                class:
                  "px-4 py-2 block relative focus-visible:z-10 text-base hover:bg-slate-100 hover:cursor-pointer dark:hover:bg-slate-600" %>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </header>

    <div class="flex flex-1 grow flex-col pt-4 sm:overflow-hidden">
      <%# Render the header slot if it's provided %>
      <turbo-frame id="sidebar-header" class="shrink-0"><%= header %></turbo-frame>

      <%# Main navigation area %>
      <div class="flex-1 space-y-1 pt-1 sm:overflow-y-auto">
        <%# Iterate over sections and render them %>
        <% sections.each do |section| %>
          <%= section %>
        <% end %>

        <%# Iterate over items and render them %>
        <% if items.present? %>
          <ul class="space-y-1">
            <% items.each do |item| %>
              <%= item %>
            <% end %>
          </ul>
        <% end %>
      </div>
    </div>

    <div class="border-t border-slate-200 p-2 dark:border-slate-800">
      <a
        href="https://phac-nml.github.io/irida-next/docs/intro"
        target="_blank"
        rel="noopener noreferrer"
        class="
          flex min-h-[44px] w-full items-center justify-center rounded-lg px-4 py-2 text-sm font-medium
          text-slate-700 hover:bg-slate-100 dark:text-slate-200 dark:hover:bg-slate-700
        "
        aria-label="<%= t('general.help') %> - <%= t('general.opens_in_new_tab') %>"
      >
        <%= pathogen_icon :question, class: "mr-2" %>
        <%= t("general.help") %>
      </a>
    </div>
  </div>
</nav>

<div
  class="
    sidebar-overlay fixed z-25 h-screen w-screen bg-slate-200/40 backdrop-blur-xs xl:invisible xl:hidden
    dark:bg-slate-600/40
  "
  data-layout-target="sidebarOverlay"
  tabindex="0"
  data-action="focus->layout#handleContentFocus"
></div>
