<div>
  <div class="grid grid-cols-3 gap-2 py-4">
    <div class="col-span-1"></div>
    <% if log_data[:version] != 1 %>
      <div
        class="
          col-span-1
          text-sm
          font-semibold
          text-slate-500
          dark:text-slate-400
        "
      ><%= t(
          :"components.history_version.previous_version",
          version: log_data[:version] - 1
        ) %></div>
    <% end %>
    <div
      class="
        col-span-1
        text-sm
        font-semibold
        text-slate-500
        dark:text-slate-400
      "
    ><%= t(:"components.history_version.current_version", version: log_data[:version]) %></div>
  </div>

  <dl
    class="
      text-slate-900
      dark:text-white
      divide-y
      divide-slate-200
      dark:divide-slate-700
    "
  >
    <div>
      <% log_data[:changes_from_prev_version].each do |key, value| %>
        <% if log_data[:version] == 1 %>
          <% next if value.blank? || value == "{}" %>
        <% end %>

        <% changes_from_prev_version_hash = json_string_to_hash(value) %>

        <% if !changes_from_prev_version_hash.nil? %>
          <div data-controller="collapsible">
            <h2 id="accordion-collapse-heading-1">
              <button
                type="button"
                class="
                  flex
                  items-center
                  justify-between
                  w-full
                  p-5
                  font-medium
                  rtl:text-right
                  text-gray-500
                  border
                  border-gray-200
                  rounded-t-xl
                  focus:ring-4
                  focus:ring-gray-200
                  dark:focus:ring-gray-800
                  dark:border-gray-700
                  dark:text-gray-400
                  hover:bg-gray-100
                  dark:hover:bg-gray-800
                  gap-3
                "
                data-action="collapsible#toggle"
                aria-expanded="true"
                aria-controls="accordion-collapse-body-1"
              >
                <span><%= key.to_s %></span>
                <svg
                  data-collapsible-target="icon"
                  class="w-3 h-3 rotate-180 shrink-0"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 10 6"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5 5 1 1 5"
                  />
                </svg>
              </button>
            </h2>
            <div
              data-collapsible-target="item"
              id="accordion-collapse-body-1"
              class="hidden"
              aria-labelledby="accordion-collapse-heading-1"
            >
              <div
                class="
                  p-5
                  border
                  border-slate-200
                  dark:border-slate-700
                  dark:bg-slate-900
                "
              >
                <div class="grid grid-cols-3 gap-2 py-2">
                  <% prev_changes_value_hash = json_string_to_hash(log_data[:previous_version][key]) %>

                  <% if !prev_changes_value_hash.nil? %>
                    <% changes_from_prev_version_hash.each do |k,v| %>
                      <% next if prev_changes_value_hash[k] == v %>

                      <% if log_data[:version] == 1 %>
                        <% col_span = "col-span-2" %>
                      <% else %>
                        <% col_span = "col-span-1" %>
                      <% end %>
                      <div class="col-span-1">
                        <dt class="mb-1 text-slate-500 text-md dark:text-slate-400"><%= k.to_s %></dt>
                      </div>
                      <div class="col-span-1 bg-slate-100 dark:bg-slate-700 dark:text-slate-700">
                        <dd class="text-md p-1"><%= prev_changes_value_hash[k] %></dd>
                      </div>
                      <div class="<%= col_span %> bg-slate-100 dark:bg-slate-700 dark:text-slate-700">
                        <dd class="text-md p-1 break-words"><%= v %></dd>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% else %>
          <div class="grid grid-cols-3 gap-2 py-2">
            <div class="col-span-1">
              <dt class="mb-1 text-slate-500 text-md dark:text-slate-400"><%= key.to_s %></dt>
            </div>
            <% if log_data[:version] != 1 %>
              <div class="col-span-1 bg-slate-100 dark:bg-slate-700 dark:text-slate-700">
                <dd class="text-md p-1"><%= log_data[:previous_version][key.to_s] %></dd>
              </div>
            <% end %>
            <% if log_data[:version] == 1 %>
              <% col_span = "col-span-2" %>
            <% else %>
              <% col_span = "col-span-1" %>
            <% end %>
            <div class="<%= col_span %> bg-slate-100 dark:bg-slate-700 dark:text-slate-700">
              <dd class="text-md p-1 break-words"><%= value %></dd>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </dl>
</div>
