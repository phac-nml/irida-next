<%= tag.div(
  data: {
    action: Flipper.enabled?(:flowbite_replacement) ? "keydown->viral--select2#keydown" : "keydown->viral--flowbite-select2#keydown",
  },
  class: "select2"
  ) do %>
  <%= tag.input(
    type: "text",
    id: id,
    name: id,
    data: {
      if Flipper.enabled?(:flowbite_replacement)
        "viral--select2-target" => "trigger",
        action: "input->viral--select2#input",
      else
        "viral--flowbite-select2-target" => "input",
        action: "input->viral--flowbite-select2#input",
      end
    },
    placeholder: placeholder,
    required: required,
    autocomplete: "off",
    class:
      "select2-input border-slate-300 text-slate-800 sm:text-sm rounded-lg block w-full p-2.5 dark:bg-slate-800 dark:border-slate-600 dark:placeholder-slate-400 dark:text-slate-50",
    value: selected_value.presence,
    aria: {
      describedby: aria_describedby.presence,
      invalid: aria_invalid,
      required: aria_required,
    },
  ) %>

  <%= form.hidden_field name, data: {
    if Flipper.enabled?(:flowbite_replacement)
      "viral--select2-target": "hidden",
    else
      "viral--flowbite-select2-target" => "hidden",
    end
  } %>

  <%= tag.div(
    data: {
      if Flipper.enabled?(:flowbite_replacement)
        "viral--select2-target": "menu",
      else
        "viral--flowbite-select2-target" => "dropdown",
      end
      },
    class: "z-10 w-full bg-white divide-y rounded-lg shadow-sm divide-slate-100 dark:bg-slate-700",
    hidden:""
  ) do %>
    <%= tag.ul(
      if Flipper.enabled?(:flowbite_replacement)
        data: { "viral--select2-target": "scroller" },
        class: "w-full py-2 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",
        style:"max-height: inherit;"
      else
        data: { "viral--select2-target": "scroller" },
        class: "max-h-[300px] w-full py-2 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",
      end
      role: "listbox",
    ) do %>
      <% options.each do |option| %>
        <%= option %>
      <% end %>

      <% if empty_state? %>
        <%= tag.li(
          empty_state,
          role: "option",
          aria: {
            disabled: "true",
            selected: "false",
          },
          class:
            "p-4 text-blue-800 border border-blue-300 bg-blue-50 dark:bg-slate-800 dark:text-blue-400 dark:border-blue-800 pointer-events-none",
          data: {
            if Flipper.enabled?(:flowbite_replacement)
              "viral--select2-target": "empty",
            else
            "viral--flowbite-select2-target": "empty",
            end
          },
          hidden:""
        ) %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
