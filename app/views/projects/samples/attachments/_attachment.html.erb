<tr
  id="<%= dom_id(attachment) %>"
  class="bg-white border-b dark:bg-slate-800 dark:border-slate-700"
>
  <td class="px-6 py-4">
    <%= check_box_tag "attachment_ids[]",
    (
      if attachment.associated_attachment
        [attachment.id, attachment.associated_attachment.id].to_s
      else
        attachment.id
      end
    ),
    nil,
    id: dom_id(attachment.file),
    "aria-label": attachment.file.filename,
    data: {
      name: attachment.file.filename,
      size: number_to_human_size(attachment.file.blob.byte_size),
      type: attachment.metadata["type"],
      action: "input->selection#toggle",
      selection_target: "rowSelection"
    },
    class:
      "w-4 h-4 text-primary-600 bg-slate-100 border-slate-300 rounded focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-slate-800 focus:ring-2 dark:bg-slate-700 dark:border-slate-600" %>
  </td>
  <% if attachment.associated_attachment && attachment.metadata['direction'] == 'forward' %>
    <td class="px-6 py-4">
      <div>
        <div class="flex mb-4 items-center">
          <%= viral_icon(name: :arrow_right, color: :subdued, classes: "h-6 w-6 ml-0 mr-2") %>
          <span>
            <%= link_to attachment.file.filename,
            download_namespace_project_sample_attachment_path(
              sample_id: @sample.id,
              id: attachment.id
            ),
            data: {
              turbo: false
            } %>
          </span>
        </div>
        <div class="flex items-center">
          <%= viral_icon(name: :arrow_left, color: :subdued, classes: "h-6 w-6 ml-0 mr-2") %>
          <span>
            <%= link_to attachment.associated_attachment.file.filename,
            download_namespace_project_sample_attachment_path(
              sample_id: @sample.id,
              id: attachment.metadata["associated_attachment_id"]
            ),
            data: {
              turbo: false
            } %>
          </span>
        </div>
      </div>
    </td>
  <% else %>
    <td class="px-6 py-4">
    <div>
        <div class="flex items-center">
          <%= viral_icon(name: :document_text, color: :subdued, classes: "h-6 w-6 ml-0 mr-2") %>
          <span>
            <%= link_to attachment.file.filename,
              download_namespace_project_sample_attachment_path(
                sample_id: @sample.id,
                id: attachment.id
              ),
              data: {
                turbo: false
              } %>
          </span>
        </div>
      </div>
    </td>
  <% end %>

  <td class="px-6 py-4"><%= viral_pill(
      text: attachment.metadata["format"],
      color: find_pill_color_for_attachment(attachment, "format")
    ) %></td>
  <td class="px-6 py-4"><%= viral_pill(
      text: attachment.metadata["type"],
      color: find_pill_color_for_attachment(attachment, "type")
    ) %></td>

  <% if attachment.associated_attachment %>
    <td class="px-6 py-4">
      <div class="mb-4">
        <%= number_to_human_size(attachment.file.blob.byte_size) %>
      </div>
      <div>
        <%= number_to_human_size(attachment.associated_attachment.file.blob.byte_size) %>
      </div>
    </td>
  <% else %>
    <td class="px-6 py-4"><%= number_to_human_size(attachment.file.blob.byte_size) %></td>
  <% end %>

  <td class="px-6 py-4">
    <%= viral_time_ago(original_time: attachment.created_at) %>
  </td>

  <td class="px-6 py-4">
    <% if allowed_to?(:update_sample?, @project) %>
      <%= button_to(
        t(".delete"),
        namespace_project_sample_attachment_path(
          sample_id: @sample.id,
          id: attachment.id
        ),
        method: "delete",
        form: {
          data: {
            "turbo-frame": "attachments",
            "turbo-confirm": t(".delete_confirm")
          }
        },
        class: "button button--state-destructive button--size-default"
      ) %>
    <% end %>
  </td>
</tr>
