<%= viral_dialog(open: open) do |dialog| %>
  <%= dialog.with_header(title: t(".title")) %>
  <%= dialog.with_section do %>

    <div
      id="scrollable"
      data-controller="infinite-scroll"
      data-action="scroll->infinite-scroll#scroll"
      class="overflow-y-auto max-h-40 mb-4"
    >
      <%= turbo_frame_tag "list_select_samples" do %>
        <div role="status" class="max-w-sm animate-pulse">
          <% 2.times do %>
            <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 max-w-[360px] mb-2.5"></div>
            <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 mb-2.5"></div>
            <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 max-w-[330px] mb-2.5"></div>
            <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 max-w-[300px] mb-2.5"></div>
            <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 max-w-[360px] mb-2.5"></div>
          <% end %>
          <span class="sr-only">Loading...</span>
        </div>
      <% end %>
    </div>
    <%= turbo_frame_tag "list_select_samples_pagination" do %>
      <%= form_with(url: list_namespace_project_samples_path) do |form| %>
        <input type="hidden" name="format" value="turbo_stream"/>
        <div
          data-controller="sessionstorage-amend-form"
          data-sessionstorage-amend-form-storage-key-value="<%=namespace_project_samples_url%>"
          data-sessionstorage-amend-form-target="field"
          data-sessionstorage-amend-form-field-name-value="sample_ids[]"
          data-sessionstorage-amend-form-page-value="1"
          data-sessionstorage-amend-form-infinite-scroll-outlet="#scrollable"
        ></div>
      <% end %>
    <% end %>

    <%= turbo_frame_tag "transfer_samples_dialog_content" do %>
      <%= form_for(:transfer, url: namespace_project_samples_transfer_path, method: :post) do |form| %>
        <div
          data-controller="sessionstorage-amend-form"
          data-sessionstorage-amend-form-storage-key-value="<%=namespace_project_samples_url%>"
          data-sessionstorage-amend-form-target="field"
          data-sessionstorage-amend-form-field-name-value="transfer[sample_ids][]"
        />
        <div class="grid gap-4">
          <div class="form-field">
            <%= form.label :new_project_id, t(".new_project_id") %>
            <%= form.collection_select(:new_project_id, @projects, :id, :full_path) %>
          </div>
          <div>
            <%= form.submit t(".submit_button"),
                        class: "button button--size-default button--state-primary",
                        disabled: @projects.count.zero?,
                        data: {
                          action: "click->sessionstorage-amend-form#clear",
                        } %>
          </div>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% end %>
