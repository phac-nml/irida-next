<%= turbo_stream.update "new_member_modal",
                    partial: "create_modal",
                    locals: {
                      open: member.errors.any? ? true : false
                    } %>

<% if @new_member.persisted? %>
  <%= turbo_stream.append "flashes" do %>
    <%= viral_flash(
      type:,
      data: message
    ) %>
  <% end %>

  <%= turbo_stream.update "project_members_list" do %>
    <table class="min-w-full table-fixed dark:divide-slate-600">
      <thead class="text-slate-700 bg-slate-50 dark:bg-slate-700 dark:text-slate-400">
        <tr>
          <th scope="col" class="px-6 py-3 text-left"><%= t(:"projects.members.index.table_header.username") %></th>
          <th scope="col" class="px-6 py-3 text-left"><%= t(:"projects.members.index.table_header.access_level") %></th>
          <th scope="col" class="px-6 py-3 text-left"><%= t(:"projects.members.index.table_header.source") %></th>
          <th scope="col" class="px-6 py-3 text-left"><%= t(:"projects.members.index.table_header.access_granted") %></th>
          <th scope="col" class="px-6 py-3 text-right"><%= t(:"projects.members.index.table_header.action") %></th>
        </tr>
      </thead>
      <tbody
        id="members-table-body"
        class="bg-white divide-y divide-slate-200 dark:bg-slate-800 dark:divide-slate-700"
      >
        <% @members.each do |member| %>
          <%= render partial: "member",
            locals: {
              member: member,
              access_levels: @access_levels
            } %>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <%= turbo_stream.update "members_pagination" do %>
    <%= render PaginationComponent.new(
    info: pagy_info(@pagy),
    prev_url:
      (
        if @pagy.prev
          namespace_project_members_url(
            @namespace.parent,
            @namespace.project,
            page: @pagy.prev
          )
        else
          nil
        end
      ),
    next_url:
      (
        if @pagy.next
          namespace_project_members_url(
            @namespace.parent,
            @namespace.project,
            page: @pagy.next
          )
        else
          nil
        end
      )
  ) %>
  <% end %>
<% end %>
