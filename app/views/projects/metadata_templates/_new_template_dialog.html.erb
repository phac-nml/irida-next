<%= viral_dialog(open: open, size: :large) do |dialog| %>
  <%= dialog.with_header(title: "New Metadata Template") %>
  <%= dialog.with_section do %>
    <%= turbo_frame_tag "metadata_template_dialog_content" do %>
      <div
        data-controller="viral--sortable-lists--two-lists-selection"
        data-viral--sortable-lists--two-lists-selection-selected-list-value="selected"
        data-viral--sortable-lists--two-lists-selection-available-list-value="available"
        data-viral--sortable-lists--two-lists-selection-field-name-value="metadata_template[fields][]"
        data-infinite-scroll-singular-description-value="AAA"
        data-infinite-scroll-plural-description-value="BBB"
        data-infinite-scroll-non-zero-header-value="CCC"
        class="font-normal text-slate-500 dark:text-slate-400"
      >
        <div class="grid gap-4">
          <%= viral_sortable_lists(
            title: "Metadata",
            description: "These are the fields available to add to the metadata template. They are aggregated from the namespace and descendants"
            ) do |sortable_lists| %>
            <%= sortable_lists.with_list(
              id: "available",
              title: "Available",
              list_items:
                @namespace.metadata_fields.sort_by do |metadata_field|
                  metadata_field.downcase
                end,
              group: "metadata_selection",
              container_classes: "block mb-1 pr-2 text-sm font-medium",
              list_classes: "overflow-y-auto max-w-[356px] min-w-[356px] w-full",
            ) %>
            <%= sortable_lists.with_list(
              id: "selected",
              title: "Selected",
              group: "metadata_selection",
              container_classes: "block mb-1 text-sm font-medium",
              list_classes: "overflow-y-auto max-w-[356px] min-w-[356px] w-full",
            ) %>
          <% end %>
          <%= form_for(:metadata_template, url: namespace_project_metadata_templates_path, method: :post
            ) do |form| %>
            <div class="grid gap-4">
              <div class="form-field mt-2">
                <%= form.label :name %>
                <%= form.text_field :name, class: "form-control", required: true %>
              </div>
              <div class="form-field mt-2">
                <%= form.label :description %>
                <%= form.text_area :description, class: "form-control" %>
              </div>
              <div
                class="hidden"
                data-viral--sortable-lists--two-lists-selection-target="field"
              ></div>
              <div>
                <%= form.submit "Submit",
                            data: {
                              turbo_frame: "_top",
                              action:
                                "click->viral--sortable-lists--two-lists-selection#constructParams",
                              "viral--sortable-lists--two-lists-selection-target": "submitBtn",
                            },
                            class: "button button--state-primary button--size-default",
                            disabled: true %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
<% end %>
