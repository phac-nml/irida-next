 <% member_source = membership_source(@namespace, namespace_group_link) %>
<tr
  id="<%= dom_id(namespace_group_link) %>"
  class="text-sm font-normal text-gray-500 dark:text-gray-400"
>
    <td class="px-6 py-4"><%= namespace_group_link.group.name %></td>
    <td class="px-6 py-4"> <% if !member_source.key?(:inherited_namespace_path) %>
          <div class="text-sm font-normal text-gray-500 dark:text-gray-400"><%= member_source[:label] %></div>
      <% else %>
        <%= viral_tooltip(title: t(:"groups.members.index.shared_inherited")) do %>
          <%= link_to member_source[:label],
          member_source[:inherited_namespace_path],
          data: {turbo_frame: "_top"},
          class: "text-grey-900 dark:text-grey-100 font-semibold hover:underline" %>
        <% end %>
      <% end %></td>
    <td class="px-6 py-4">
      <div>
        <span class="text-sm"><%= distance_of_time_in_words(Time.now, namespace_group_link.created_at) %></span>
        <span class="block">
          <%= turbo_frame_tag("invited-group-#{namespace_group_link.group.id}-updated") do %>
            <% if namespace_group_link.created_at < namespace_group_link.updated_at %>
              <%= render UpdatedComponent.new(
                updated_at: namespace_group_link.updated_at
              ) %>
            <% end %>
          <% end %>
        </span>
      </div>
    </td>
    <td class="px-6 py-4">
      <div class="form-field">
        <% if allowed_to?(:update_namespace_with_group_link?, @namespace) && !member_source.key?(:inherited_namespace_path) %>
          <%= form_with(model: namespace_group_link, url: namespace_project_group_link_path(@namespace.parent, @namespace.project, namespace_group_link), method: :patch) do |form| %>
            <%= form.select(
              :group_access_level,
              @access_levels,
              {:selected => namespace_group_link.group_access_level},
              {
                id: "invited-group-#{namespace_group_link.group.id}-access-level-select",
                onchange: "this.form.requestSubmit();",
                "aria-label": t(:"projects.group_links.index.aria_labels.group_access_level")
              }
            ) %>
            <input type="hidden" name="format" value="turbo_stream"/>
          <% end %>
        <% else %>
           <%= t(:"projects.group_links.index.access_level.level_#{namespace_group_link.group_access_level}") %>
        <% end %>
      </div>
    </td>
    <td class="px-6 py-4">
      <% if allowed_to?(:update_namespace_with_group_link?, @namespace) && !member_source.key?(:inherited_namespace_path) %>
        <%= form_with( model: namespace_group_link, url: namespace_project_group_link_path(@namespace.parent, @namespace.project, namespace_group_link), method: :patch) do |form| %>
          <div
            class="form-field datepicker"
            data-controller="datepicker"
          >
            <div class="relative max-w-sm">
              <div
                class="
                  absolute
                  inset-y-0
                  left-0
                  flex
                  items-center
                  pl-3
                  pointer-events-none
                "
              >
                <%= render Viral::IconComponent.new(
                  name: "calendar_days",
                  classes: "w-5 h-5 text-gray-500 dark:text-gray-400"
                ) %>
              </div>
              <%= form.text_field :expires_at,
                          placeholder: "YYYY-MM-DD",
                          autocomplete: "off",
                          value: namespace_group_link.expires_at,
                          id: "invited-group-#{namespace_group_link.group.id}-expiration",
                          "data-datepicker-target": "datePicker",
                          "data-datepicker-autosubmit": "true",
                          "aria-label": t(:"projects.group_links.index.aria_labels.expires_at") %>

              <input type="hidden" name="format" value="turbo_stream"/>
          </div>
        <% end %>
      <% else %>
         <%= namespace_group_link.expires_at %>
      <% end %>
    </td>
    <td class="px-6 py-4">
      <% if allowed_to?(:unlink_namespace_with_group?, @namespace) && !member_source.key?(:inherited_namespace_path) %>
        <%= link_to t(:"projects.group_links.index.unlink"),
                    namespace_project_group_link_path(@namespace.parent, @namespace.project, namespace_group_link),
                    data: {
                            turbo_method: :delete,
                            turbo_confirm: t(:"projects.group_links.index.unlink_confirmation"),
                            turbo_stream: true
                    },
                    class: "
                      button
                      button--state-destructive
                      button--size-default
                      inline-block
                    "
        %>
      <% end %>
    </td>
  </tr>
