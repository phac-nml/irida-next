<%= turbo_frame_tag('members') do %>
  <div class="flex flex-col">
    <div class="overflow-x-auto">
      <div class="shadow">
        <table class="min-w-full table-fixed dark:divide-gray-600">
          <thead class="text-gray-700 bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
            <tr>
              <th scope="col" class="px-6 py-3 text-left"><%= t(:"groups.members.invited_groups.table_header.group") %></th>
              <th scope="col" class="px-6 py-3 text-left"><%= t(:"groups.members.invited_groups.table_header.source") %></th>
              <th scope="col" class="px-6 py-3 text-left"><%= t(:"groups.members.invited_groups.table_header.access_granted") %></th>
              <th scope="col" class="px-6 py-3 text-left"><%= t(:"groups.members.invited_groups.table_header.access_level") %></th>
              <th scope="col" class="px-6 py-3 text-left"><%= t(:"groups.members.invited_groups.table_header.expiration") %></th>
              <th scope="col" class="px-6 py-3 text-left"><%= t(:"groups.members.invited_groups.table_header.action") %></th>
            </tr>
          </thead>
          <tbody
            class="
              bg-white
              divide-y
              divide-gray-200
              dark:bg-gray-800
              dark:divide-gray-700
            "
          >
            <% @namespace.shared_with_group_links.each do |namespace_group_link| %>
              <tr class="text-sm font-normal text-gray-500 dark:text-gray-400">
                <td class="px-6 py-4"><%= namespace_group_link.group.name %></td>
                <td class="px-6 py-4"><%= namespace_group_link.namespace == @namespace ? "Direct Member" : namespace_group_link.namespace.name %></td>
                <td class="px-6 py-4"><%= distance_of_time_in_words(Time.now, namespace_group_link.created_at) %></td>
                <td class="px-6 py-4">
                  <div class="form-field">
                    <%= form_with( url: '#', method: :patch) do |form| %>
                      <%= form.select(
                        :group_access_level,
                        @access_levels,
                        {},
                        {
                          id: "invited-group-#{namespace_group_link.group.id}-access-level-select",
                          value: namespace_group_link.group_access_level,
                          onchange: "this.form.requestSubmit();",
                          "aria-label": t(:"projects.members.invited_groups.aria_labels.group_access_level")
                        }
                      ) %>
                      <input type="hidden" name="format" value="turbo_stream"/>
                    <% end %>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <%= form_with( url: '#', method: :patch) do |form| %>
                    <div
                      class="form-field datepicker"
                      data-controller="datepicker"
                    >
                      <div class="relative max-w-sm">
                        <div
                          class="
                            absolute
                            inset-y-0
                            left-0
                            flex
                            items-center
                            pl-3
                            pointer-events-none
                          "
                        >
                          <%= render Viral::IconComponent.new(
                            name: "calendar_days",
                            classes: "w-5 h-5 text-gray-500 dark:text-gray-400"
                          ) %>
                        </div>
                        <%= form.text_field :expires_at,
                                    placeholder: "YYYY-MM-DD",
                                    autocomplete: "off",
                                    value: namespace_group_link.expires_at,
                                    onblur: "this.form.requestSubmit();",
                                    "data-datepicker-target": "datePicker" %>

                        <input type="hidden" name="format" value="turbo_stream"/>
                    </div>
                  <% end %>
                </td>
                <td class="px-6 py-4">
                  <button
                    class="
                      button
                      button--state-destructive
                      button--size-default
                      inline-block
                    "
                  >
                    <%= t(:"groups.members.invited_groups.buttons.unshare") %>
                  </button>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>
