<%= render Viral::PageHeaderComponent.new(title: @group.name, id: @group.puid, subtitle: @group.description) do |component| %>
  <%= component.icon do %>
    <%= viral_avatar(
      name: @group.name,
      colour_string: "#{@group.name}-#{@group.id}",
      size: :large,
    ) %>
  <% end %>
  <%= component.with_buttons do %>
    <% if @allowed_to[:create_subgroup_or_project] %>
      <%= link_to t(:"groups.show.create_subgroup_button"),
      new_group_path(parent_id: @group.id),
      class: "button button--size-default button--state-default" %>
      <%= link_to t(:"groups.show.create_project_button"),
      new_project_path(group_id: @group.id),
      class: "button button--size-default button--state-primary ml-2" %>
    <% end %>
  <% end %>
<% end %>

<div class="flex flex-col lg:flex-row gap-4">
  <section
    aria-labelledby="groups-dashboard-info-title"
    class="
      p-4 bg-white border rounded-lg border-slate-200 dark:border-slate-700
      dark:bg-slate-800 order-1 lg:order-2 lg:w-[250px] lg:flex-shrink-0 lg:mt-12
    "
  >
    <h2
      id="groups-dashboard-info-title"
      class="mb-4 text-xl font-semibold text-slate-900 dark:text-white"
    ><%= t(:"groups.show.information.title") %></h2>

    <p class="py-2 dark:text-slate-300">
      <% if @group.description && !@group.description.blank? %>
        <%= @group.description %>
      <% else %>
        <%= t(:"groups.show.information.no_description") %>
      <% end %>
    </p>

    <hr class="h-px my-4 border-0 bg-slate-200 dark:bg-slate-600"/>

    <div class="flex flex-row lg:flex-col gap-4">
      <%# Samples Stat Box %>
      <div
        class="
          flex-1 p-4 rounded-lg shadow-sm bg-blue-50 dark:bg-blue-900 dark:border
          dark:border-blue-700
        "
      >
        <div class="block md:hidden">
          <div class="flex items-center justify-start gap-2">
            <%= viral_tooltip(title: t(:"groups.show.information.number_of_samples")) do %>
              <span
                id="group-samples-icon-sm"
                class="
                  inline-flex items-center justify-center p-2 rounded-full bg-blue-100
                  dark:bg-blue-700
                "
              >
                <%= render_icon(ICONS[:samples], class: "h-4 w-4 text-blue-700 dark:text-blue-200") %>
              </span>
            <% end %>
            <div
              class="text-xl font-semibold text-slate-900 dark:text-slate-100"
              aria-labelledby="group-samples-icon-sm"
            >
              <%# TODO: Ensure @group.samples_count is implemented or passed to the view %>
              <%= @group.samples_count || 0 %>
            </div>
          </div>
        </div>
        <div class="hidden md:block">
          <div class="flex items-center mb-1">
            <span
              id="group-samples-icon-lg"
              class="
                inline-flex items-center justify-center p-2 rounded-full bg-blue-100
                dark:bg-blue-700 mr-2
              "
            >
              <%= render_icon(ICONS[:samples], class: "h-5 w-5 text-blue-700 dark:text-blue-200") %>
            </span>
            <span
              id="group-samples-label-lg"
              class="text-sm font-semibold text-slate-600 dark:text-slate-300"
            >
              <%= t(:"groups.show.information.number_of_samples") %>
            </span>
          </div>
          <div
            class="
              text-2xl font-semibold text-slate-900 dark:text-slate-100 pl-11
            "
            aria-labelledby="group-samples-icon-lg group-samples-label-lg"
          >
            <%# TODO: Ensure @group.samples_count is implemented or passed to the view %>
            <%= @group.samples_count || 0 %>
          </div>
        </div>
      </div>

      <%# Projects Stat Box %>
      <div
        class="
          flex-1 p-4 rounded-lg shadow-sm bg-fuchsia-50 dark:bg-fuchsia-900 dark:border
          dark:border-fuchsia-700
        "
      >
        <div class="block md:hidden">
          <div class="flex items-center justify-start gap-2">
            <%= viral_tooltip(title: t(:"groups.show.information.number_of_projects")) do %>
              <span
                id="group-projects-icon-sm"
                class="
                  inline-flex items-center justify-center p-2 rounded-full bg-fuchsia-100
                  dark:bg-fuchsia-700
                "
              >
                <%= render_icon(
                  ICONS[:projects],
                  class: "h-4 w-4 text-fuchsia-700 dark:text-fuchsia-200",
                ) %>
              </span>
            <% end %>
            <div
              class="text-xl font-semibold text-slate-900 dark:text-slate-100"
              aria-labelledby="group-projects-icon-sm"
            >
              <%= @group.project_namespaces.count %>
            </div>
          </div>
        </div>
        <div class="hidden md:block">
          <div class="flex items-center mb-1">
            <span
              id="group-projects-icon-lg"
              class="
                inline-flex items-center justify-center p-2 rounded-full bg-fuchsia-100
                dark:bg-fuchsia-700 mr-2
              "
            >
              <%= render_icon(
                ICONS[:projects],
                class: "h-5 w-5 text-fuchsia-700 dark:text-fuchsia-200",
              ) %>
            </span>
            <span
              id="group-projects-label-lg"
              class="text-sm font-semibold text-slate-600 dark:text-slate-300"
            >
              <%= t(:"groups.show.information.number_of_projects") %>
            </span>
          </div>
          <div
            class="
              text-2xl font-semibold text-slate-900 dark:text-slate-100 pl-11
            "
            aria-labelledby="group-projects-icon-lg group-projects-label-lg"
          >
            <%= @group.project_namespaces.count %>
          </div>
        </div>
      </div>

      <%# Subgroups Stat Box %>
      <div
        class="
          flex-1 p-4 rounded-lg shadow-sm bg-amber-50 dark:bg-amber-900 dark:border
          dark:border-amber-700
        "
      >
        <div class="block md:hidden">
          <div class="flex items-center justify-start gap-2">
            <%= viral_tooltip(title: t(:"groups.show.information.number_of_subgroups")) do %>
              <span
                id="group-subgroups-icon-sm"
                class="
                  inline-flex items-center justify-center p-2 rounded-full bg-amber-100
                  dark:bg-amber-700
                "
              >
                <%= render_icon(ICONS[:groups], class: "h-4 w-4 text-amber-700 dark:text-amber-200") %>
              </span>
            <% end %>
            <div
              class="text-xl font-semibold text-slate-900 dark:text-slate-100"
              aria-labelledby="group-subgroups-icon-sm"
            >
              <%= @group.children.count %>
            </div>
          </div>
        </div>
        <div class="hidden md:block">
          <div class="flex items-center mb-1">
            <span
              id="group-subgroups-icon-lg"
              class="
                inline-flex items-center justify-center p-2 rounded-full bg-amber-100
                dark:bg-amber-700 mr-2
              "
            >
              <%= render_icon(ICONS[:groups], class: "h-5 w-5 text-amber-700 dark:text-amber-200") %>
            </span>
            <span
              id="group-subgroups-label-lg"
              class="text-sm font-semibold text-slate-600 dark:text-slate-300"
            >
              <%= t(:"groups.show.information.number_of_subgroups") %>
            </span>
          </div>
          <div
            class="
              text-2xl font-semibold text-slate-900 dark:text-slate-100 pl-11
            "
            aria-labelledby="group-subgroups-icon-lg group-subgroups-label-lg"
          >
            <%= @group.children.count %>
          </div>
        </div>
      </div>
    </div>

    <hr class="h-px my-4 border-0 bg-slate-200 dark:bg-slate-600"/>

    <p class="py-2 dark:text-slate-300">
      <span class="font-semibold"><%= t(:"groups.show.information.created_on") %></span>
      <span><%= local_time(@group.created_at, :full_date) %></span>
    </p>
  </section>

  <section class="order-2 lg:order-1 flex-grow">
    <%= viral_tabs(id: "group-details", label: t(:'.tabs.label')) do |tabs| %>
      <%= tabs.with_tab(url: group_path(@group), selected: @tab != "shared_namespaces") do %>
        <%= t(:".tabs.subgroups_and_projects") %>
      <% end %>
      <%= tabs.with_tab(url: group_path(@group, tab: "shared_namespaces"), selected: @tab == "shared_namespaces") do %>
        <%= t(:".tabs.shared_namespaces") %>
      <% end %>

      <%= tabs.with_tab_content do %>
        <div class="mt-2">
          <div class="flex flex-row-reverse mb-2">
            <%= render SearchComponent.new(query: @q, url: group_path(@group), search_attribute: :name_or_puid_cont, placeholder: t(".search.placeholder")) do %>

              <% if @tab == "shared_namespaces" %>
                <input type="hidden" name="tab" value="shared_namespaces">
              <% end %>
            <% end %>
          </div>

          <% if @tab == "shared_namespaces" %>
            <%= render "groups/shared_namespaces/index", locals: { namespaces: @namespaces } %>
          <% else %>
            <%= render "groups/subgroups/index", locals: { namespaces: @namespaces } %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </section>
</div>
