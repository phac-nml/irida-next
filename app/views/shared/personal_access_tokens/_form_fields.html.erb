<%# locals: (pat:, form:) -%>

<% invalid_token_name = pat.errors.include?(:name) %>
<div class="form-field <%= 'invalid' if invalid_token_name %>">
  <%= form.label :name, data: { required: true } %>
  <%= form.text_field :name,
                  required: true,
                  class: "form-control",
                  aria: {
                    describedby:
                      (
                        if invalid_token_name
                          form.field_id(:name, "error")
                        else
                          nil
                        end
                      ),
                    invalid: invalid_token_name,
                    required: true,
                  },
                  autofocus: invalid_token_name %>
  <% if invalid_token_name %>
    <%= render "shared/form/field_errors",
    id: form.field_id(:name, "error"),
    errors: pat.errors.full_messages_for(:name) %>
  <% end %>
</div>
<div class="form-field">
  <%= pathogen_datepicker(
    id: form.field_id(:expires_at),
    input_name: form.field_name(:expires_at),
    label: t("activerecord.attributes.personal_access_token.expires_at"),
    selected_date: pat[:expires_at],
  ) %>
</div>
<% invalid_scopes = pat.errors.include?(:scopes) %>
<div class="form-field <%= 'invalid' if invalid_scopes %>">
  <fieldset>
    <legend><%= t(:"activerecord.attributes.personal_access_token.scopes") %>
      <abbr class="req" title="<%= t('pathogen.label.title') %>"><%= t("pathogen.label.required_indicator") %></abbr></legend>
    <% Irida::Auth.all_available_scopes.each do |scope| %>
      <div class="flex">
        <div class="flex items-center h-5">
          <%= form.check_box :scopes,
                         {
                           checked: pat.scopes.include?(scope.to_s),
                           aria: {
                             describedby:
                               (
                                 if invalid_scopes
                                   form.field_id(:scopes, "error")
                                 else
                                   nil
                                 end
                               ),
                             invalid: invalid_scopes,
                           },
                           include_hidden: false,
                           multiple: true,
                         },
                         scope %>
        </div>
        <div class="ml-2 text-sm">
          <%= label_tag form.field_id(:scopes, scope.to_s),
          scope,
          "aria-describedby": form.field_id(:scopes, scope.to_s, "help-text"),
          class: "font-medium text-slate-900 dark:text-slate-300" %>
          <p
            id="<%= form.field_id(:scopes, scope.to_s, "help-text") %>"
            class="text-xs font-normal text-slate-500 dark:text-slate-400"
          ><%= t("auth.scopes.#{scope}") %></p>
        </div>
      </div>
    <% end %>
  </fieldset>
  <% if invalid_scopes %>
    <%= render "shared/form/field_errors",
    id: form.field_id(:scopes, "error"),
    errors: pat.errors.full_messages_for(:scopes) %>
  <% end %>
</div>
